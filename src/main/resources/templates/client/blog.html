<!DOCTYPE html>
<html lang="en" layout:decorate="~{fragments/_layout}" xmlns:th="http://www.thymeleaf.org"
    xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout">

<head>
    <title>Blog</title>
    <meta charset="utf-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">

    <th:block layout:fragment="styles">
        <style>
            .empty-state {
                text-align: center;
                padding: 60px 20px;
            }

            .empty-state i {
                font-size: 4rem;
                color: #dee2e6;
                margin-bottom: 20px;
            }

            .card {
                border-radius: 15px;
                overflow: hidden;
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
                transition: all 0.3s ease;
                border: none;
            }

            .card:hover {
                transform: translateY(-5px);
                box-shadow: 0 10px 25px rgba(0, 0, 0, 0.12);
            }

            .card-img-top {
                height: 200px;
                object-fit: cover;
            }
        </style>
    </th:block>
</head>

<body>
    <main layout:fragment="content">
        <div class="container-fluid page-header mb-5 wow fadeIn" data-wow-delay="0.1s">
            <div class="container text-center">
                <h1 class="display-4 text-white animated slideInDown mb-4">Tin Tức</h1>
                <nav aria-label="breadcrumb animated slideInDown">
                    <ol class="breadcrumb justify-content-center mb-0">
                        <li class="breadcrumb-item"><a class="text-white" th:href="@{/}">Home</a></li>
                        <li class="breadcrumb-item text-primary active" aria-current="page">Tin Tức</li>
                    </ol>
                </nav>
            </div>
        </div>

        <div class="container mb-5">
            <div class="row">
                <div class="col-lg-8">
                    <h4 class="pretty-heading mb-4">Các tin tức mới nhất</h4>

                    <!-- Blog posts -->
                    <div th:if="${blog != null and not #lists.isEmpty(blog)}">
                        <div class="row" id="blog-container">
                            <div class="col-md-6 mb-4" th:each="item, iterStat : ${blog}">
                                <div class="card" th:classappend="${iterStat.index >= 8} ? 'd-none' : ''">
                                    <img th:src="@{ '/img/blog/' +  ${item.imageUrl}}" class="card-img-top"
                                        alt="News Image">
                                    <div class="card-body">
                                        <h5 class="card-title" th:text="${item.title}">News Title</h5>
                                        <p class="card-text text-muted" th:text="${item.createdAt}">Creation Date</p>
                                        <a th:href="@{/blog/{id}(id=${item.id})}"
                                            class="btn btn-primary rounded-pill px-4">Read More</a>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="text-center mt-4">
                            <button id="seeMoreBtn" class="btn btn-primary rounded-pill px-4 py-2">See More</button>
                        </div>
                    </div>

                    <!-- Empty state when no blog posts -->
                    <div th:if="${blog == null or #lists.isEmpty(blog)}" class="empty-state">
                        <i class="far fa-newspaper d-block"></i>
                        <h4 class="text-muted mb-3">Chưa có tin tức nào</h4>
                        <p class="text-muted mb-4">Hiện tại chưa có bài viết nào. Vui lòng quay lại sau!</p>
                        <a th:href="@{/}" class="btn btn-primary rounded-pill px-4 py-2">
                            <i class="fas fa-home me-2"></i>Về trang chủ
                        </a>
                    </div>
                </div>

                <div class="col-lg-4">
                    <h4 class="pretty-heading mb-4">Hoàn cảnh quyên góp mới nhất</h4>

                    <!-- Programs sidebar -->
                    <div th:if="${program != null and not #lists.isEmpty(program)}" class="program-list">
                        <div class="program-card show mb-4" th:each="item, stat : ${program}"
                            th:if="${stat.count <= 3}">
                            <img th:src="@{'/img/program/' + ${item.image}}" class="card-img-top" alt="Program image">
                            <div class="card-body">
                                <h5 class="card-title" th:text="${item.name}">Program Name</h5>
                                <div class="amount-container">
                                    <h6 class="text-primary">
                                        <span
                                            th:text="${@amountFormatter.formatAmount(item.currentAmount)}">6.699.367</span>
                                        <small class="text-muted">/ </small>
                                        <span
                                            th:text="${@amountFormatter.formatAmount(item.goalAmount)}">200.000.000</span>
                                    </h6>
                                </div>
                                <div class="progress">
                                    <div class="progress-bar" role="progressbar"
                                        th:style="'width:' + ${item.percentageAchieved} + '%'"
                                        th:aria-valuenow="${item.percentageAchieved}" aria-valuemin="0"
                                        aria-valuemax="100">
                                    </div>
                                </div>
                                <div class="stats-container">
                                    <div class="stat-item">
                                        <div class="stat-value" th:text="${item.donationCount}">1.266</div>
                                        <div class="stat-label">Lượt quyên góp</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-value" th:text="${item.percentageAchieved} + '%'">3%</div>
                                        <div class="stat-label">Đạt được</div>
                                    </div>
                                    <div class="stat-item">
                                        <div class="stat-value" th:text="${item.remainingDays}">68</div>
                                        <div class="stat-label">Ngày còn lại</div>
                                    </div>
                                </div>
                                <div class="text-center">
                                    <a th:href="@{/program/{id}(id=${item.programId})}" class="btn btn-donate"
                                        th:classappend="${item.currentAmount >= item.goalAmount} ? 'disabled' : ''"
                                        th:attr="disabled=${item.currentAmount >= item.goalAmount}">
                                        Quyên góp ngay
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Empty state for programs sidebar -->
                    <div th:if="${program == null or #lists.isEmpty(program)}" class="text-center py-4">
                        <p class="text-muted">Chưa có chương trình nào.</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <th:block layout:fragment="scripts">
        <script>
            document.addEventListener('DOMContentLoaded', function () {
                var seeMoreBtn = document.getElementById('seeMoreBtn');
                if (seeMoreBtn) {
                    var hiddenCards = document.querySelectorAll('.card.d-none');
                    if (hiddenCards.length === 0) {
                        seeMoreBtn.style.display = 'none';
                    }
                    seeMoreBtn.addEventListener('click', function () {
                        var hiddenCards = document.querySelectorAll('.card.d-none');
                        for (var i = 0; i < 8 && i < hiddenCards.length; i++) {
                            hiddenCards[i].classList.remove('d-none');
                        }
                        if (document.querySelectorAll('.card.d-none').length === 0) {
                            seeMoreBtn.style.display = 'none';
                        }
                    });
                }
            });
        </script>
    </th:block>
</body>

</html>